<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OpenClaw Agent ä¸å“åº” - è¯Šæ–­å†³ç­–æ ‘</title>
<style>
  :root {
    --bg: #0d1117;
    --card: #161b22;
    --border: #30363d;
    --text: #e6edf3;
    --muted: #8b949e;
    --green: #3fb950;
    --red: #f85149;
    --yellow: #d29922;
    --blue: #58a6ff;
    --purple: #bc8cff;
    --orange: #f0883e;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    padding: 1.5rem;
  }
  h1 { font-size: 1.6rem; margin-bottom: 0.3rem; }
  .subtitle { color: var(--muted); margin-bottom: 1.5rem; font-size: 0.9rem; }

  /* Two-column layout */
  .layout {
    display: grid;
    grid-template-columns: 1fr 340px;
    gap: 1.5rem;
    align-items: start;
    max-width: 1280px;
    margin: 0 auto;
  }
  @media (max-width: 900px) {
    .layout { grid-template-columns: 1fr; }
    .seq-panel { position: static !important; }
  }

  /* Left: Decision tree */
  .tree { display: flex; flex-direction: column; }
  .node {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    transition: border-color 0.2s;
  }
  .node.active { border-color: var(--blue); box-shadow: 0 0 0 1px var(--blue); }
  .node-header {
    padding: 0.85rem 1rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.65rem;
    user-select: none;
    transition: background 0.15s;
  }
  .node-header:hover { background: rgba(255,255,255,0.03); }
  .step-badge {
    background: var(--blue);
    color: #fff;
    font-size: 0.7rem;
    font-weight: 700;
    padding: 0.15rem 0.5rem;
    border-radius: 12px;
    white-space: nowrap;
    flex-shrink: 0;
  }
  .node-title { font-weight: 600; font-size: 0.95rem; flex: 1; }
  .arrow { color: var(--muted); transition: transform 0.2s; flex-shrink: 0; font-size: 0.8rem; }
  .node.open .arrow { transform: rotate(90deg); }
  .node-body { display: none; padding: 0 1rem 1rem; }
  .node.open .node-body { display: block; }
  .check {
    background: rgba(88,166,255,0.08);
    border-left: 3px solid var(--blue);
    padding: 0.6rem 0.8rem;
    border-radius: 0 6px 6px 0;
    margin-bottom: 0.8rem;
    font-size: 0.85rem;
  }
  .check code, .fix code, .cause code {
    background: rgba(255,255,255,0.1);
    padding: 0.1rem 0.35rem;
    border-radius: 4px;
    font-size: 0.8rem;
  }
  .branch { margin: 0.6rem 0; padding-left: 0.8rem; border-left: 2px solid var(--border); }
  .branch-label { font-weight: 600; margin-bottom: 0.3rem; display: flex; align-items: center; gap: 0.4rem; font-size: 0.9rem; }
  .tag-yes { background: rgba(63,185,80,0.15); color: var(--green); font-size: 0.7rem; font-weight: 700; padding: 0.1rem 0.45rem; border-radius: 10px; }
  .tag-no { background: rgba(248,81,73,0.15); color: var(--red); font-size: 0.7rem; font-weight: 700; padding: 0.1rem 0.45rem; border-radius: 10px; }
  .cause { background: rgba(248,81,73,0.06); border-left: 3px solid var(--red); padding: 0.5rem 0.7rem; border-radius: 0 6px 6px 0; margin: 0.4rem 0; font-size: 0.85rem; }
  .cause strong { color: var(--red); }
  .fix { background: rgba(63,185,80,0.06); border-left: 3px solid var(--green); padding: 0.5rem 0.7rem; border-radius: 0 6px 6px 0; margin: 0.4rem 0; font-size: 0.85rem; }
  .fix strong { color: var(--green); }
  .connector { display: flex; justify-content: center; padding: 0.2rem 0; }
  .connector svg { width: 20px; height: 20px; color: var(--muted); }
  .next-step { color: var(--blue); font-size: 0.8rem; margin-top: 0.4rem; }

  /* Right: Sequence diagram */
  .seq-panel {
    position: sticky;
    top: 1.5rem;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1rem;
  }
  .seq-title {
    font-size: 0.85rem;
    font-weight: 700;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.8rem;
  }
  .seq-diagram { position: relative; }

  /* Lifelines */
  .seq-actors {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr;
    text-align: center;
    margin-bottom: 0.5rem;
  }
  .seq-actor {
    font-size: 0.7rem;
    font-weight: 700;
    color: var(--muted);
    padding: 0.3rem 0;
    border-bottom: 2px solid var(--border);
  }

  .seq-rows { position: relative; }
  .seq-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr;
    min-height: 44px;
    position: relative;
    transition: all 0.2s;
  }
  .seq-row::before {
    content: '';
    position: absolute;
    top: 0; bottom: 0;
    left: calc(12.5%); width: 1px;
    background: var(--border);
  }
  .seq-row::after {
    content: '';
    position: absolute;
    top: 0; bottom: 0;
    left: calc(37.5%); width: 1px;
    background: var(--border);
  }
  .seq-row .line3 {
    position: absolute;
    top: 0; bottom: 0;
    left: calc(62.5%); width: 1px;
    background: var(--border);
  }
  .seq-row .line4 {
    position: absolute;
    top: 0; bottom: 0;
    left: calc(87.5%); width: 1px;
    background: var(--border);
  }

  .seq-row.active {
    background: rgba(88,166,255,0.06);
    border-radius: 4px;
  }
  .seq-row.fail {
    background: rgba(248,81,73,0.06);
    border-radius: 4px;
  }

  .seq-msg {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    height: 2px;
    background: var(--blue);
    z-index: 2;
  }
  .seq-msg.fail-line { background: var(--red); }
  .seq-msg-label {
    position: absolute;
    top: -14px;
    font-size: 0.65rem;
    white-space: nowrap;
    color: var(--text);
    font-weight: 500;
  }
  .seq-msg-arrow {
    position: absolute;
    right: -4px;
    top: -3px;
    width: 0; height: 0;
    border-left: 5px solid var(--blue);
    border-top: 4px solid transparent;
    border-bottom: 4px solid transparent;
  }
  .seq-msg.fail-line .seq-msg-arrow { border-left-color: var(--red); }

  .seq-step-num {
    position: absolute;
    left: 4px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.6rem;
    font-weight: 700;
    color: var(--blue);
    background: var(--bg);
    padding: 0 3px;
    border-radius: 3px;
    z-index: 3;
  }
  .seq-row.fail .seq-step-num { color: var(--red); }
  .seq-row.active .seq-step-num { color: var(--blue); background: rgba(88,166,255,0.15); }

  .seq-x {
    position: absolute;
    top: 50%;
    transform: translate(-50%, -50%);
    color: var(--red);
    font-size: 1.1rem;
    font-weight: 900;
    z-index: 3;
  }

  .seq-legend {
    margin-top: 0.8rem;
    padding-top: 0.6rem;
    border-top: 1px solid var(--border);
    font-size: 0.7rem;
    color: var(--muted);
    line-height: 1.8;
  }
  .seq-legend-dot {
    display: inline-block;
    width: 8px; height: 8px;
    border-radius: 50%;
    margin-right: 4px;
    vertical-align: middle;
  }

  footer {
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border);
    color: var(--muted);
    font-size: 0.8rem;
    text-align: center;
    max-width: 1280px;
    margin-left: auto;
    margin-right: auto;
  }
</style>
</head>
<body>

<div style="max-width:1280px;margin:0 auto;">
<h1>OpenClaw Agent ä¸å“åº” â€” è¯Šæ–­å†³ç­–æ ‘</h1>
<p class="subtitle">å·¦è¾¹æŒ‰æ­¥éª¤æ£€æŸ¥ï¼Œå³è¾¹æ—¶åºå›¾åŒæ­¥é«˜äº®å½“å‰ç¯èŠ‚ã€‚ç‚¹å‡»å±•å¼€æ¯ä¸€æ­¥ã€‚</p>
</div>

<div class="layout">

<!-- LEFT: Decision tree -->
<div class="tree">

<!-- Step 1 -->
<div class="node open active" id="step1" data-step="1">
  <div class="node-header" onclick="activate(1)">
    <span class="step-badge">Step 1</span>
    <span class="node-title">æ¶ˆæ¯æœ‰ ğŸ‘€ ååº”å—ï¼Ÿ</span>
    <span class="arrow">&#9654;</span>
  </div>
  <div class="node-body">
    <div class="check"><strong>æ£€æŸ¥æ–¹å¼ï¼š</strong>åœ¨ Discord é¢‘é“é‡Œçœ‹æ¶ˆæ¯ä¸‹æ–¹æ˜¯å¦å‡ºç° ğŸ‘€ ååº”</div>
    <div class="branch">
      <div class="branch-label"><span class="tag-no">æ²¡æœ‰ ğŸ‘€</span> æ¶ˆæ¯æ²¡åˆ° OpenClaw</div>
      <div class="cause"><strong>å¯èƒ½åŸå› ï¼š</strong></div>
      <ul style="margin:0.4rem 0 0.4rem 1.3rem; font-size:0.85rem;">
        <li>Discord WebSocket æ–­è¿ï¼ˆcode 1005/1006ï¼‰</li>
        <li><code>groupPolicy</code> ä¸æ˜¯ <code>"open"</code>ï¼Œé¢‘é“ä¸åœ¨ç™½åå•</li>
        <li>Discord token å¤±æ•ˆ / bot ä¸‹çº¿</li>
      </ul>
      <div class="fix"><strong>ä¿®å¤ï¼š</strong><code>openclaw status --deep</code> æŸ¥çŠ¶æ€ï¼›<code>openclaw gateway restart</code></div>
    </div>
    <div class="branch">
      <div class="branch-label"><span class="tag-yes">æœ‰ ğŸ‘€</span> æ¶ˆæ¯å·²åˆ°è¾¾ OpenClaw</div>
      <p class="next-step">&#8594; è¿›å…¥ Step 2</p>
    </div>
  </div>
</div>
<div class="connector"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7 7 7-7"/></svg></div>

<!-- Step 2 -->
<div class="node" id="step2" data-step="2">
  <div class="node-header" onclick="activate(2)">
    <span class="step-badge">Step 2</span>
    <span class="node-title">æ—¥å¿—æœ‰ cli exec å—ï¼Ÿ</span>
    <span class="arrow">&#9654;</span>
  </div>
  <div class="node-body">
    <div class="check"><strong>æ£€æŸ¥æ–¹å¼ï¼š</strong><code>openclaw logs --max-bytes 20000 | grep "cli exec"</code></div>
    <div class="branch">
      <div class="branch-label"><span class="tag-no">æ²¡æœ‰ cli exec</span> æ¶ˆæ¯æ²¡è§¦å‘ agent</div>
      <div class="cause"><strong>å¯èƒ½åŸå› ï¼š</strong><code>bindings</code> é…ç½®é”™è¯¯ï¼Œé¢‘é“ ID æ²¡ç»‘å®š agent</div>
      <div class="fix"><strong>ä¿®å¤ï¼š</strong>æ£€æŸ¥ <code>openclaw.json</code> çš„ <code>bindings</code> æ•°ç»„</div>
    </div>
    <div class="branch">
      <div class="branch-label"><span class="tag-yes">æœ‰ cli exec</span> Claude CLI å·²è¢«è°ƒç”¨</div>
      <p class="next-step">&#8594; è¿›å…¥ Step 3</p>
    </div>
  </div>
</div>
<div class="connector"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7 7 7-7"/></svg></div>

<!-- Step 3 -->
<div class="node" id="step3" data-step="3">
  <div class="node-header" onclick="activate(3)">
    <span class="step-badge">Step 3</span>
    <span class="node-title">cli exec å»¶è¿Ÿå¾ˆä¹…å—ï¼ˆ>30sï¼‰ï¼Ÿ</span>
    <span class="arrow">&#9654;</span>
  </div>
  <div class="node-body">
    <div class="check"><strong>æ£€æŸ¥æ–¹å¼ï¼š</strong>å¯¹æ¯”æ—¥å¿—ä¸­ <code>cli exec</code> æ—¶é—´æˆ³å’Œ Discord æ¶ˆæ¯å‘é€æ—¶é—´</div>
    <div class="branch">
      <div class="branch-label"><span class="tag-no">å»¶è¿Ÿ >30s</span> è¢«ä¸²è¡Œé˜Ÿåˆ—é˜»å¡</div>
      <div class="cause"><strong>åŸå› ï¼š</strong><code>serialize</code> é»˜è®¤ <code>true</code>ï¼Œæ‰€æœ‰ agent å…±ç”¨ä¸²è¡Œé˜Ÿåˆ—</div>
      <div class="fix"><strong>ä¿®å¤ï¼š</strong><code>cliBackends.claude-cli.serialize = false</code></div>
    </div>
    <div class="branch">
      <div class="branch-label"><span class="tag-yes">å¾ˆå¿«å‡ºç°</span> æ²¡æœ‰é˜Ÿåˆ—é˜»å¡</div>
      <p class="next-step">&#8594; è¿›å…¥ Step 4</p>
    </div>
  </div>
</div>
<div class="connector"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7 7 7-7"/></svg></div>

<!-- Step 4 -->
<div class="node" id="step4" data-step="4">
  <div class="node-header" onclick="activate(4)">
    <span class="step-badge">Step 4</span>
    <span class="node-title">Claude CLI è¿”å›äº†å“åº”å—ï¼Ÿ</span>
    <span class="arrow">&#9654;</span>
  </div>
  <div class="node-body">
    <div class="check"><strong>æ£€æŸ¥æ–¹å¼ï¼š</strong><code>openclaw logs --max-bytes 30000 | grep -A2 "cli exec"</code></div>
    <div class="branch">
      <div class="branch-label"><span class="tag-no">æ²¡æœ‰å“åº” / æŠ¥é”™</span> Claude CLI å¤±è´¥</div>
      <div class="cause"><strong>æ’æŸ¥ï¼š</strong></div>
      <ul style="margin:0.4rem 0 0.4rem 1.3rem; font-size:0.85rem;">
        <li>æ‰‹åŠ¨æµ‹è¯•ï¼š<code>echo "test" | claude -p --output-format json</code></li>
        <li>API key / ç½‘ç»œ / å†…å­˜é—®é¢˜</li>
        <li>Session context è¶… 200k token</li>
      </ul>
      <div class="fix"><strong>ä¿®å¤ï¼š</strong>æ¸… sessionï¼š<code>rm ~/.claude/projects/-Users-*-openclaw-workspace-*/*.jsonl</code></div>
    </div>
    <div class="branch">
      <div class="branch-label"><span class="tag-yes">æœ‰å“åº”</span> CLI æ­£å¸¸è¿”å›</div>
      <p class="next-step">&#8594; è¿›å…¥ Step 5</p>
    </div>
  </div>
</div>
<div class="connector"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7 7 7-7"/></svg></div>

<!-- Step 5 -->
<div class="node" id="step5" data-step="5">
  <div class="node-header" onclick="activate(5)">
    <span class="step-badge">Step 5</span>
    <span class="node-title">å“åº”æ˜¯ HEARTBEAT_OK / NO_REPLY å—ï¼Ÿ</span>
    <span class="arrow">&#9654;</span>
  </div>
  <div class="node-body">
    <div class="check"><strong>æ£€æŸ¥æ–¹å¼ï¼š</strong>è¯» Claude session <code>.jsonl</code>ï¼Œçœ‹ assistant çš„ <code>content.text</code><br>
      <code>ls -lt ~/.claude/projects/-Users-*-openclaw-workspace-*/*.jsonl | head -3</code>
    </div>
    <div class="branch">
      <div class="branch-label"><span class="tag-no">æ˜¯ HEARTBEAT_OK / NO_REPLY</span> è¢«é™é»˜è¿‡æ»¤</div>
      <div class="cause"><strong>åŸå›  1ï¼š</strong>OpenClaw æ³¨å…¥ "Be extremely selective, stay silent"</div>
      <div class="fix"><strong>ä¿®å¤ï¼š</strong>é¢‘é“åŠ  <code>"systemPrompt": "Dedicated channel. Always respond."</code></div>
      <div class="cause"><strong>åŸå›  2ï¼š</strong>AGENTS.md "Stay silent" è§„åˆ™è¿‡æ¿€</div>
      <div class="fix"><strong>ä¿®å¤ï¼š</strong>æ”¹ AGENTS.mdï¼Œé»˜è®¤ RESPOND</div>
      <div class="cause"><strong>åŸå›  3ï¼š</strong>æ—§ session ç¼“å­˜äº†æ²‰é»˜è¡Œä¸º</div>
      <div class="fix"><strong>ä¿®å¤ï¼š</strong>æ¸… <code>.jsonl</code> + <code>sessions.json â†’ {}</code></div>
    </div>
    <div class="branch">
      <div class="branch-label"><span class="tag-yes">æ­£å¸¸æ–‡æœ¬</span> Claude å›å¤æ­£å¸¸</div>
      <p class="next-step">&#8594; è¿›å…¥ Step 6</p>
    </div>
  </div>
</div>
<div class="connector"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7 7 7-7"/></svg></div>

<!-- Step 6 -->
<div class="node" id="step6" data-step="6">
  <div class="node-header" onclick="activate(6)">
    <span class="step-badge">Step 6</span>
    <span class="node-title">å“åº”é€è¾¾ Discord äº†å—ï¼Ÿ</span>
    <span class="arrow">&#9654;</span>
  </div>
  <div class="node-body">
    <div class="check"><strong>æ£€æŸ¥æ–¹å¼ï¼š</strong>æ—¥å¿—æœ deliver / sendï¼›Discord é¢‘é“æ˜¯å¦æ˜¾ç¤º bot å›å¤</div>
    <div class="branch">
      <div class="branch-label"><span class="tag-no">æ²¡é€è¾¾</span> Discord æŠ•é€’å¤±è´¥</div>
      <div class="cause"><strong>å¯èƒ½åŸå› ï¼š</strong>Bot æ— å‘æ¶ˆæ¯æƒé™ / æ¶ˆæ¯è¶…é•¿ / API é™æµ / WebSocket æ–­è¿</div>
      <div class="fix"><strong>ä¿®å¤ï¼š</strong>æ£€æŸ¥ bot æƒé™ï¼›<code>openclaw gateway restart</code></div>
    </div>
    <div class="branch">
      <div class="branch-label"><span class="tag-yes">å·²é€è¾¾</span> é—®é¢˜å·²è§£å†³</div>
    </div>
  </div>
</div>

</div>

<!-- RIGHT: Sequence diagram -->
<div class="seq-panel">
  <div class="seq-title">æ¶ˆæ¯æ—¶åºå›¾</div>
  <div class="seq-diagram">
    <div class="seq-actors">
      <div class="seq-actor">Discord</div>
      <div class="seq-actor">Gateway</div>
      <div class="seq-actor">Queue</div>
      <div class="seq-actor">Claude</div>
    </div>
    <div class="seq-rows" id="seqRows">

      <!-- Row 1: User sends message â†’ Gateway -->
      <div class="seq-row active" data-seq="1">
        <span class="line3"></span><span class="line4"></span>
        <span class="seq-step-num">1</span>
        <div class="seq-msg" style="left:12.5%;width:25%;">
          <span class="seq-msg-label" style="left:10%;">ç”¨æˆ·å‘æ¶ˆæ¯</span>
          <span class="seq-msg-arrow"></span>
        </div>
      </div>

      <!-- Row 1b: Gateway â†’ Discord (ğŸ‘€) -->
      <div class="seq-row" data-seq="1">
        <span class="line3"></span><span class="line4"></span>
        <div class="seq-msg" style="left:37.5%;width:0;overflow:visible;">
          <div style="position:absolute;right:0;top:-3px;width:25%;height:2px;background:var(--green);direction:rtl;">
            <span class="seq-msg-label" style="left:-5px;color:var(--green);">ğŸ‘€ ack</span>
            <span class="seq-msg-arrow" style="right:auto;left:-4px;border-left:none;border-right:5px solid var(--green);"></span>
          </div>
        </div>
      </div>

      <!-- Row 2: Gateway â†’ Queue (route) -->
      <div class="seq-row" data-seq="2">
        <span class="line3"></span><span class="line4"></span>
        <span class="seq-step-num">2</span>
        <div class="seq-msg" style="left:37.5%;width:25%;">
          <span class="seq-msg-label" style="left:5%;">è·¯ç”±åˆ° agent</span>
          <span class="seq-msg-arrow"></span>
        </div>
      </div>

      <!-- Row 3: Queue wait -->
      <div class="seq-row" data-seq="3">
        <span class="line3"></span><span class="line4"></span>
        <span class="seq-step-num">3</span>
        <div style="position:absolute;left:calc(62.5% - 22px);top:50%;transform:translateY(-50%);font-size:0.6rem;color:var(--yellow);white-space:nowrap;z-index:3;background:var(--card);padding:0 4px;border-radius:3px;border:1px solid var(--yellow);">serialize?</div>
      </div>

      <!-- Row 3b: Queue â†’ Claude (spawn) -->
      <div class="seq-row" data-seq="3">
        <span class="line3"></span><span class="line4"></span>
        <div class="seq-msg" style="left:62.5%;width:25%;">
          <span class="seq-msg-label" style="left:2%;">cli exec</span>
          <span class="seq-msg-arrow"></span>
        </div>
      </div>

      <!-- Row 4: Claude processing -->
      <div class="seq-row" data-seq="4">
        <span class="line3"></span><span class="line4"></span>
        <span class="seq-step-num">4</span>
        <div style="position:absolute;left:calc(87.5% - 16px);top:50%;transform:translateY(-50%);font-size:0.6rem;color:var(--purple);white-space:nowrap;z-index:3;background:var(--card);padding:0 4px;border-radius:3px;border:1px solid var(--purple);">thinking...</div>
      </div>

      <!-- Row 4b: Claude â†’ Queue (response) -->
      <div class="seq-row" data-seq="4">
        <span class="line3"></span><span class="line4"></span>
        <div class="seq-msg" style="left:62.5%;width:25%;overflow:visible;">
          <div style="position:absolute;right:0;top:-1px;width:100%;height:2px;background:var(--purple);direction:rtl;">
            <span class="seq-msg-label" style="left:5%;color:var(--purple);">response</span>
            <span class="seq-msg-arrow" style="right:auto;left:-4px;border-left:none;border-right:5px solid var(--purple);"></span>
          </div>
        </div>
      </div>

      <!-- Row 5: Filter check -->
      <div class="seq-row" data-seq="5">
        <span class="line3"></span><span class="line4"></span>
        <span class="seq-step-num">5</span>
        <div style="position:absolute;left:calc(37.5% - 28px);top:50%;transform:translateY(-50%);font-size:0.6rem;color:var(--orange);white-space:nowrap;z-index:3;background:var(--card);padding:0 4px;border-radius:3px;border:1px solid var(--orange);">NO_REPLY?</div>
      </div>

      <!-- Row 5b: filter result -->
      <div class="seq-row" data-seq="5">
        <span class="line3"></span><span class="line4"></span>
        <div style="position:absolute;left:calc(37.5% - 20px);top:50%;transform:translateY(-50%);font-size:0.55rem;color:var(--red);white-space:nowrap;z-index:3;">
          <span id="filterResult">&#10005; è¢«è¿‡æ»¤ = æ²‰é»˜</span>
        </div>
      </div>

      <!-- Row 6: Gateway â†’ Discord (deliver) -->
      <div class="seq-row" data-seq="6">
        <span class="line3"></span><span class="line4"></span>
        <span class="seq-step-num">6</span>
        <div class="seq-msg" style="left:37.5%;width:0;overflow:visible;">
          <div style="position:absolute;right:0;top:-1px;width:25%;height:2px;background:var(--green);direction:rtl;">
            <span class="seq-msg-label" style="left:-5%;color:var(--green);">deliver</span>
            <span class="seq-msg-arrow" style="right:auto;left:-4px;border-left:none;border-right:5px solid var(--green);"></span>
          </div>
        </div>
      </div>

      <!-- Row 6b: Discord shows reply -->
      <div class="seq-row" data-seq="6">
        <span class="line3"></span><span class="line4"></span>
        <div style="position:absolute;left:calc(12.5% - 14px);top:50%;transform:translateY(-50%);font-size:0.6rem;color:var(--green);white-space:nowrap;z-index:3;background:var(--card);padding:0 4px;border-radius:3px;border:1px solid var(--green);">bot å›å¤</div>
      </div>

    </div>
  </div>

  <div class="seq-legend">
    <span class="seq-legend-dot" style="background:var(--blue);"></span>æ­£å¸¸è¯·æ±‚
    <span class="seq-legend-dot" style="background:var(--green);margin-left:8px;"></span>æˆåŠŸè¿”å›
    <span class="seq-legend-dot" style="background:var(--red);margin-left:8px;"></span>å¤±è´¥/è¿‡æ»¤<br>
    <span class="seq-legend-dot" style="background:var(--purple);"></span>Claude å¤„ç†
    <span class="seq-legend-dot" style="background:var(--yellow);margin-left:8px;"></span>å¯èƒ½é˜»å¡ç‚¹
  </div>
</div>

</div>

<footer>
  <p>åŸºäº 2026-02-10 å®é™… debug ç»éªŒæ€»ç»“ &middot; OpenClaw + Claude CLI (cliBackend) æ¶æ„</p>
  <p style="margin-top:0.3rem">å¸¸ç”¨å‘½ä»¤ï¼š<code>openclaw status --deep</code> &middot; <code>openclaw logs --max-bytes 20000</code> &middot; <code>openclaw gateway restart</code></p>
</footer>

<script>
let currentStep = 1;

function activate(step) {
  const node = document.getElementById('step' + step);
  const wasOpen = node.classList.contains('open');

  // Toggle open/close
  if (currentStep === step) {
    node.classList.toggle('open');
  } else {
    // Close previous, open new
    document.querySelectorAll('.node').forEach(n => {
      n.classList.remove('active');
      if (n.dataset.step != step) n.classList.remove('open');
    });
    node.classList.add('open');
  }

  node.classList.add('active');
  document.querySelectorAll('.node').forEach(n => {
    if (n !== node) n.classList.remove('active');
  });

  currentStep = step;

  // Highlight sequence rows
  document.querySelectorAll('.seq-row').forEach(row => {
    const seq = parseInt(row.dataset.seq);
    row.classList.remove('active', 'fail');
    if (seq === step) {
      row.classList.add('active');
    } else if (seq > step) {
      row.style.opacity = '0.25';
    } else {
      row.style.opacity = '1';
    }
  });
  // Current and past rows full opacity
  document.querySelectorAll('.seq-row').forEach(row => {
    const seq = parseInt(row.dataset.seq);
    if (seq <= step) row.style.opacity = '1';
  });
}

// Initialize
activate(1);
</script>

</body>
</html>
